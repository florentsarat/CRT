{
  "designerVersion" : "1.9.53",
  "id" : "customAdvanceTable",
  "name" : "AdvanceTable",
  "lastUpdate" : 1568299346507,
  "template" : "\n<div id=mainTable>\n    <div id=\"myModal\" class=\"modal\" tabindex=\"-1\" role=\"dialog\">\n      <div class=\"modal-dialog\" role=\"document\">\n        <div class=\"modal-content\">\n          <div class=\"modal-header\">\n            <h5 id=\"modalTitle\" class=\"modal-title\">Modal title</h5>\n          </div>\n          <div id=\"modalContent\" class=\"modal-body\">\n            <p>Request details</p>\n          </div>\n          <div class=\"modal-footer\">\n            <button type=\"button\" id=\"ModalClose\" class=\"btn btn-secondary\" data-dismiss=\"modal\">Close</button>\n          </div>\n        </div>\n      </div>\n    </div>\n</div>\n\n",
  "controller" : "\nfunction ($scope,$http, $window) {\n    // Get current user id by performing a call to /API/system/session\n    let myCustomer;\n\n    // Current user id\n    var userId;\n\n\n    $http.get('../API/system/session/1').\n    success(function(data, status, header, config) {\n        // Get the user id from REST API call answer\n        userId = data.user_id;\n        console.log(userId);\n        let tablediv = document.querySelector(\"#mainTable\");\n        let myHeader = [\"Customer\", \"Delivery Date\", \"Priority\", \"Status\",\"     \"];\n        $http.get('../API//bdm/businessData/com.company.model.itemChangeRequestv2?q=getAllPendingByUser&p=0&c=10&f=userId='+userId).\n        success(function(data, status, header, config) {\n            myCustomer = data;\n            console.log(\"TaskReceived\");\n            var table = document.createElement('table');\n            table.type = \"mytable\";\n            table.className = \"table table-dark thead-dark table-striped\";\n            table.style=\"width:100%\";\n\n            generateTableHead(table, myHeader);\n            for (let request of myCustomer) {\n                let row = table.insertRow();\n\n                let customerCell = row.insertCell();\n                let customerCelltext = document.createTextNode(request[\"customerRequesting\"]);\n                customerCell.appendChild(customerCelltext);\n                \n                let dateCell = row.insertCell();\n                let dateCelltext = document.createTextNode(request[\"targetDeliveryDate\"]);\n                dateCell.appendChild(dateCelltext);\n\n                let priorityCell = row.insertCell();\n                let priorityCelltext = document.createTextNode(request[\"priority\"]);\n                priorityCell.appendChild(priorityCelltext);\n\n                let statusCell = row.insertCell();\n                let statusCellText = document.createTextNode(request[\"status\"]);\n                statusCell.appendChild(statusCellText);\n                \n                let actionCell = row.insertCell();\n                \n\n                var btn = document.createElement('button');\n                btn.type = \"mybutton\";\n                var caseID = request[\"caseID\"];\n                // console.log(caseID);\n                \n                if (request[\"status\"]==\"Initiated\")\n                {\n                    btn.innerHTML = \"Complete\";\n                    btn.className = \"btn btn-danger\"\n                    btn.onclick = function(){redirectToTaskForm(userId, caseID);};\n                }\n                else\n                {\n                    btn.innerHTML = \"View Details\";\n                    btn.className = \"btn btn-primary\";\n                    btn.onclick = function(){PopUpInfo(request);};\n                }\n                \n                btn.id=request[\"id\"];\n                actionCell.appendChild(btn);\n            }\n            tablediv.appendChild(table);\n        }).\n        error(function(data, status, headers, config) {\n            console.error(\"Fail to GET - List\");\n            return;\n        });\n    }).\n    error(function(data, status, headers, config) {\n        console.error(\"Fail to get user id\");\n        return;\n    });\n\n    function redirectToTaskForm(myID, caseID) {\n        console.log(\"myfunc\");\n        $http.get('../API/bpm/humanTask?c=1&p=0&f=state=ready&f=user_id=' + myID + '&f=caseId=' + caseID).\n        success(function(data, status, headers, config) {\n            if (data[0]) {\n                $window.location.href = '../portal/form/taskInstance/' + data[0].id;\n            }\n        }).\n        error(function(data, status, headers, config) {\n            console.log(\"Can't find do the get\"); \n        });\n    }\n\n    function PopUpInfo(request)\n    {\n        var modal = document.getElementById(\"myModal\");\n        var modalTitle = document.getElementById(\"modalTitle\");\n        var clossebtn = document.getElementById(\"ModalClose\");\n        clossebtn.onclick =  function(){ClosePopUp();};\n        modalTitle.innerHTML= \"Request NÂ°\"+ request.persistenceId_string;\n        modal.style.display = \"block\";\n        var modalContent = document.getElementById(\"modalContent\");\n        var customerInput = document.createElement('INPUT');\n        customerInput.id=\"CustomerInfo\";\n        customerInput.setAttribute(\"type\", \"text\");\n        customerInput.className = \"form-control\";\n        customerInput.readonly=true;\n        customerInput.setAttribute(\"value\", request.customerRequesting);\n        modalContent.appendChild(customerInput);\n\n    }\n\n    function ClosePopUp()\n    {\n        var modal = document.getElementById(\"myModal\");\n        var customerInput= document.getElementById(\"CustomerInfo\");\n        customerInput.remove();\n        modal.style.display = \"none\";\n    }\n\n\n    function generateTableHead(table, data) {\n      let thead = table.createTHead();\n      let row = thead.insertRow();\n      for (let key of data) {\n        let th = document.createElement(\"th\");\n        let text = document.createTextNode(key);\n        th.appendChild(text);\n        row.appendChild(th);\n      }\n    }\n}",
  "custom" : true,
  "properties" : [ {
    "label" : "Value",
    "name" : "value",
    "type" : "text",
    "defaultValue" : "This is the initial value",
    "bond" : "expression"
  }, {
    "label" : "Color",
    "name" : "color",
    "type" : "choice",
    "defaultValue" : "RebeccaPurple",
    "choiceValues" : [ "RebeccaPurple", "Chartreuse", "Tomato", "DeepSkyBlue" ],
    "bond" : "expression"
  }, {
    "label" : "Background color on click",
    "name" : "background",
    "type" : "choice",
    "defaultValue" : "Yellow",
    "choiceValues" : [ "Yellow", "LightGray" ],
    "bond" : "expression"
  } ],
  "assets" : [ ],
  "requiredModules" : [ ],
  "type" : "widget",
  "hasHelp" : false
}